<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard RDA - Documenta√ß√£o T√©cnica</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      line-height: 1.6;
      color: #1e293b;
      background: #f8fafc;
      padding: 2rem;
    }
    .container { max-width: 900px; margin: 0 auto; background: white; padding: 3rem; border-radius: 12px; box-shadow: 0 4px 24px rgba(0,0,0,0.1); }
    h1 { color: #0f172a; font-size: 2.5rem; margin-bottom: 0.5rem; border-bottom: 4px solid #3b82f6; padding-bottom: 1rem; }
    h2 { color: #1e40af; font-size: 1.5rem; margin-top: 2.5rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e2e8f0; }
    h3 { color: #334155; font-size: 1.2rem; margin-top: 1.5rem; margin-bottom: 0.75rem; }
    p { margin-bottom: 1rem; color: #475569; }
    code { background: #f1f5f9; padding: 0.2rem 0.5rem; border-radius: 4px; font-family: 'Monaco', 'Consolas', monospace; font-size: 0.9em; color: #dc2626; }
    pre { background: #1e293b; color: #e2e8f0; padding: 1.5rem; border-radius: 8px; overflow-x: auto; margin: 1rem 0; }
    pre code { background: none; color: #e2e8f0; padding: 0; }
    table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
    th, td { border: 1px solid #e2e8f0; padding: 0.75rem 1rem; text-align: left; }
    th { background: #1e293b; color: white; font-weight: 600; }
    tr:nth-child(even) { background: #f8fafc; }
    ul, ol { margin: 1rem 0 1rem 2rem; }
    li { margin-bottom: 0.5rem; }
    .badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.8rem; font-weight: 600; }
    .badge-error { background: #fef2f2; color: #dc2626; }
    .badge-success { background: #f0fdf4; color: #16a34a; }
    .badge-warning { background: #fffbeb; color: #d97706; }
    .badge-info { background: #eff6ff; color: #2563eb; }
    .alert { padding: 1rem 1.5rem; border-radius: 8px; margin: 1rem 0; }
    .alert-warning { background: #fffbeb; border-left: 4px solid #f59e0b; }
    .alert-error { background: #fef2f2; border-left: 4px solid #ef4444; }
    .alert-info { background: #eff6ff; border-left: 4px solid #3b82f6; }
    .color-box { display: inline-block; width: 20px; height: 20px; border-radius: 4px; vertical-align: middle; margin-right: 8px; border: 1px solid #e2e8f0; }
    .file-tree { background: #1e293b; color: #e2e8f0; padding: 1.5rem; border-radius: 8px; font-family: monospace; font-size: 0.9rem; }
    .file-tree .folder { color: #60a5fa; }
    .file-tree .file { color: #a5b4fc; }
    .file-tree .highlight { color: #fbbf24; font-weight: bold; }
    .header-meta { color: #64748b; font-size: 0.9rem; margin-bottom: 2rem; }
    @media print {
      body { background: white; padding: 0; }
      .container { box-shadow: none; padding: 1rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéØ Dashboard RDA - Controle de Entregas</h1>
    <p class="header-meta">Documenta√ß√£o T√©cnica para Desenvolvedores | Gerado em: <script>document.write(new Date().toLocaleDateString('pt-BR'))</script></p>
    
    <p>Sistema de controle de entregas offline desenvolvido em <strong>React + TypeScript</strong>. Importa planilhas Excel e gera dashboards interativos com gr√°ficos, KPIs e exporta√ß√£o.</p>

    <h2>üéØ Objetivo do Projeto</h2>
    <p>Aplica√ß√£o web que permite:</p>
    <ol>
      <li><strong>Importar</strong> planilhas Excel com dados de controle de entregas (RDA)</li>
      <li><strong>Visualizar</strong> dashboards com KPIs, gr√°ficos e matriz pessoa √ó dia</li>
      <li><strong>Filtrar</strong> por equipe, pessoa, status e per√≠odo</li>
      <li><strong>Exportar</strong> para PDF e Excel com formata√ß√£o profissional</li>
    </ol>

    <h2>üõ†Ô∏è Stack Tecnol√≥gica</h2>
    <table>
      <thead>
        <tr><th>Tecnologia</th><th>Vers√£o</th><th>Uso</th></tr>
      </thead>
      <tbody>
        <tr><td>React</td><td>18.3.1</td><td>Framework UI</td></tr>
        <tr><td>TypeScript</td><td>-</td><td>Tipagem est√°tica</td></tr>
        <tr><td>Vite</td><td>5.x</td><td>Build tool</td></tr>
        <tr><td>Tailwind CSS</td><td>3.x</td><td>Estiliza√ß√£o</td></tr>
        <tr><td>Recharts</td><td>2.15.4</td><td>Gr√°ficos</td></tr>
        <tr><td>SheetJS (xlsx)</td><td>0.18.5</td><td>Parser de Excel</td></tr>
        <tr><td>xlsx-js-style</td><td>1.2.0</td><td>Excel com estilos</td></tr>
        <tr><td>jsPDF</td><td>4.0.0</td><td>Gera√ß√£o de PDF</td></tr>
        <tr><td>html2canvas</td><td>1.4.1</td><td>Screenshot para PDF</td></tr>
        <tr><td>idb-keyval</td><td>6.2.2</td><td>Storage local (IndexedDB)</td></tr>
        <tr><td>date-fns</td><td>3.6.0</td><td>Manipula√ß√£o de datas</td></tr>
        <tr><td>shadcn/ui</td><td>-</td><td>Componentes UI</td></tr>
      </tbody>
    </table>

    <h2>üìÅ Estrutura do Projeto</h2>
    <div class="file-tree">
      <span class="folder">src/</span><br>
      ‚îú‚îÄ‚îÄ <span class="folder">components/</span><br>
      ‚îÇ   ‚îú‚îÄ‚îÄ <span class="folder">dashboard/</span><br>
      ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ <span class="file">Charts.tsx</span> ‚Äî Gr√°ficos (Line, Bar, Pie, Progress Ring)<br>
      ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ <span class="file">DashboardView.tsx</span> ‚Äî Tela principal do dashboard<br>
      ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ <span class="file">KPICard.tsx</span> ‚Äî Cards de indicadores<br>
      ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ <span class="file">KPIDetailModal.tsx</span> ‚Äî Modal com detalhes dos KPIs<br>
      ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ <span class="file">MatrixTable.tsx</span> ‚Äî Tabela matriz pessoa √ó dia<br>
      ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ <span class="file">Sidebar.tsx</span> ‚Äî Barra lateral com filtros<br>
      ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ <span class="file">SpreadsheetView.tsx</span> ‚Äî Vis√£o tabular dos dados<br>
      ‚îÇ   ‚îî‚îÄ‚îÄ <span class="folder">ui/</span> ‚Äî Componentes shadcn/ui<br>
      ‚îú‚îÄ‚îÄ <span class="folder">hooks/</span><br>
      ‚îÇ   ‚îî‚îÄ‚îÄ <span class="file">useDatasets.ts</span> ‚Äî Hook para gerenciar datasets<br>
      ‚îú‚îÄ‚îÄ <span class="folder">lib/</span><br>
      ‚îÇ   ‚îú‚îÄ‚îÄ <span class="file">database.ts</span> ‚Äî Storage com IndexedDB<br>
      ‚îÇ   ‚îú‚îÄ‚îÄ <span class="file">excelParser.ts</span> ‚Äî Parser de Excel para Dataset<br>
      ‚îÇ   ‚îú‚îÄ‚îÄ <span class="highlight">excelExport.ts</span> ‚Äî ‚ö†Ô∏è EXPORTA√á√ÉO EXCEL (PRECISA AJUDA)<br>
      ‚îÇ   ‚îú‚îÄ‚îÄ <span class="file">pdfExport.ts</span> ‚Äî Exporta√ß√£o PDF<br>
      ‚îÇ   ‚îú‚îÄ‚îÄ <span class="file">htmlExport.ts</span> ‚Äî Exporta√ß√£o HTML<br>
      ‚îÇ   ‚îî‚îÄ‚îÄ <span class="file">utils.ts</span> ‚Äî Utilit√°rios gerais<br>
      ‚îú‚îÄ‚îÄ <span class="folder">pages/</span><br>
      ‚îÇ   ‚îî‚îÄ‚îÄ <span class="file">Index.tsx</span> ‚Äî P√°gina principal<br>
      ‚îî‚îÄ‚îÄ <span class="file">main.tsx</span> ‚Äî Entry point
    </div>

    <h2>üìä Modelo de Dados</h2>
    
    <h3>Interface Dataset</h3>
    <pre><code>interface Dataset {
  id: string;                    // ID √∫nico gerado
  name: string;                  // Nome do arquivo
  createdAt: string;             // Data cria√ß√£o (ISO)
  updatedAt: string;             // Data atualiza√ß√£o (ISO)
  rawGrid: any[][];              // Grid original do Excel
  rows: DatasetRow[];            // Dados normalizados
  teams: string[];               // Lista de equipes
  people: string[];              // Lista de pessoas
  statuses: string[];            // Lista de status
}</code></pre>

    <h3>Interface DatasetRow</h3>
    <pre><code>interface DatasetRow {
  date: string;    // Data no formato YYYY-MM-DD
  person: string;  // Nome do colaborador
  status: string;  // Status: ENTREGUE, FOLGA, BANCO DE HORAS, VAZIO
  team?: string;   // Equipe (opcional)
}</code></pre>

    <h3>Status Poss√≠veis</h3>
    <table>
      <thead><tr><th>Status</th><th>Descri√ß√£o</th></tr></thead>
      <tbody>
        <tr><td><code>ENTREGUE</code></td><td>RDA entregue</td></tr>
        <tr><td><code>FOLGA</code></td><td>Dia de folga</td></tr>
        <tr><td><code>BANCO DE HORAS</code></td><td>Compensa√ß√£o</td></tr>
        <tr><td><code>VAZIO</code></td><td>Sem informa√ß√£o</td></tr>
        <tr><td><code>FALTA</code></td><td>Faltou</td></tr>
        <tr><td><code>ATESTADO</code></td><td>Atestado m√©dico</td></tr>
        <tr><td><code>F√âRIAS</code></td><td>Em f√©rias</td></tr>
      </tbody>
    </table>

    <h2>üì• Formato do Excel de Entrada</h2>
    <p>O sistema espera planilhas Excel no seguinte formato:</p>
    <table>
      <thead>
        <tr><th>Linha</th><th>A (Data)</th><th>B</th><th>C</th><th>D</th></tr>
      </thead>
      <tbody>
        <tr><td>1</td><td>TITULO</td><td>...</td><td>...</td><td>...</td></tr>
        <tr><td>2</td><td>(vazio)</td><td>EQUIPE CAMPO</td><td>EQUIPE CAMPO</td><td>EQUIPE ESCRITORIO</td></tr>
        <tr><td>3</td><td>DATA</td><td>Jo√£o Silva</td><td>Maria</td><td>Pedro</td></tr>
        <tr><td>4</td><td>01/01/2026</td><td>ENTREGUE</td><td>FOLGA</td><td>ENTREGUE</td></tr>
        <tr><td>5</td><td>02/01/2026</td><td>ENTREGUE</td><td>ENTREGUE</td><td>BANCO</td></tr>
      </tbody>
    </table>
    
    <p><strong>Regras de Parser (<code>excelParser.ts</code>):</strong></p>
    <ul>
      <li><strong>Linha 2</strong>: Headers de equipe (detecta "EQUIPE")</li>
      <li><strong>Linha 3</strong>: Nomes dos colaboradores</li>
      <li><strong>Linha 4+</strong>: Dados (coluna A = data, demais = status)</li>
    </ul>

    <h2>üì§ Exporta√ß√£o Excel Atual</h2>
    <h3>Arquivo: <code>src/lib/excelExport.ts</code></h3>
    <p>Atualmente gera 7 abas:</p>
    <ol>
      <li><strong>Matriz</strong> ‚Äî Pessoa √ó Dia com chips (ENT/FOL/BAN/-)</li>
      <li><strong>KPIs</strong> ‚Äî Indicadores principais</li>
      <li><strong>Ranking</strong> ‚Äî Colaboradores ordenados por entrega</li>
      <li><strong>Equipes</strong> ‚Äî An√°lise por equipe</li>
      <li><strong>Por Dia</strong> ‚Äî Evolu√ß√£o di√°ria</li>
      <li><strong>Dados</strong> ‚Äî Registros completos</li>
      <li><strong>PowerBI</strong> ‚Äî Formato flat para Pivot</li>
    </ol>

    <div class="alert alert-error">
      <h3>‚ö†Ô∏è PROBLEMA ATUAL</h3>
      <p>O usu√°rio precisa de <strong>formata√ß√£o condicional RGB real</strong> nas c√©lulas do Excel, similar ao que faria no Power BI.</p>
    </div>

    <h3>Requisitos n√£o atendidos:</h3>
    <ul>
      <li><span class="badge badge-error">‚ùå</span> Cores RGB aplicadas corretamente nas c√©lulas</li>
      <li><span class="badge badge-error">‚ùå</span> Formata√ß√£o condicional din√¢mica baseada em valores</li>
      <li><span class="badge badge-error">‚ùå</span> Gr√°ficos embutidos no Excel (barras, pizza)</li>
      <li><span class="badge badge-error">‚ùå</span> Tabelas din√¢micas pr√©-configuradas</li>
      <li><span class="badge badge-error">‚ùå</span> Compatibilidade total com Power BI</li>
    </ul>

    <h3>Tentativa atual:</h3>
    <ul>
      <li>Usa biblioteca <code>xlsx-js-style</code> para aplicar estilos</li>
      <li>Cores definidas em objeto <code>COLORS</code> com valores hex</li>
      <li>Fun√ß√µes <code>createStyle()</code>, <code>getStatusStyle()</code>, <code>getEvaluationStyle()</code></li>
      <li>Aplica estilos c√©lula a c√©lula com <code>applyCellStyle()</code></li>
    </ul>

    <div class="alert alert-warning">
      <strong>Erro de build:</strong><br>
      <code>Assets exceeding the limit: assets/index-CFaIROXZ.js is 2.79 MB</code><br>
      A biblioteca <code>xlsx-js-style</code> √© muito pesada e causa erro no PWA.
    </div>

    <h2>üé® Sistema de Cores</h2>
    
    <h3>Paleta de Status</h3>
    <table>
      <thead><tr><th>Status</th><th>Cor</th><th>Hex BG</th><th>Hex FG</th></tr></thead>
      <tbody>
        <tr>
          <td>ENTREGUE</td>
          <td><span class="color-box" style="background:#22C55E"></span>Verde</td>
          <td><code>22C55E</code></td>
          <td><code>FFFFFF</code></td>
        </tr>
        <tr>
          <td>FOLGA</td>
          <td><span class="color-box" style="background:#3B82F6"></span>Azul</td>
          <td><code>3B82F6</code></td>
          <td><code>FFFFFF</code></td>
        </tr>
        <tr>
          <td>BANCO DE HORAS</td>
          <td><span class="color-box" style="background:#F59E0B"></span>√Çmbar</td>
          <td><code>F59E0B</code></td>
          <td><code>000000</code></td>
        </tr>
        <tr>
          <td>VAZIO</td>
          <td><span class="color-box" style="background:#EF4444"></span>Vermelho</td>
          <td><code>EF4444</code></td>
          <td><code>FFFFFF</code></td>
        </tr>
        <tr>
          <td>HEADER</td>
          <td><span class="color-box" style="background:#1E293B"></span>Slate escuro</td>
          <td><code>1E293B</code></td>
          <td><code>FFFFFF</code></td>
        </tr>
        <tr>
          <td>TITLE</td>
          <td><span class="color-box" style="background:#0F172A"></span>Slate mais escuro</td>
          <td><code>0F172A</code></td>
          <td><code>FFFFFF</code></td>
        </tr>
      </tbody>
    </table>

    <h3>Paleta de Avalia√ß√£o (baseado em %)</h3>
    <table>
      <thead><tr><th>Avalia√ß√£o</th><th>Condi√ß√£o</th><th>Cor</th><th>Hex BG</th></tr></thead>
      <tbody>
        <tr>
          <td>Excelente</td>
          <td>‚â• 80%</td>
          <td><span class="color-box" style="background:#16A34A"></span>Verde 600</td>
          <td><code>16A34A</code></td>
        </tr>
        <tr>
          <td>Bom</td>
          <td>‚â• 60%</td>
          <td><span class="color-box" style="background:#2563EB"></span>Azul 600</td>
          <td><code>2563EB</code></td>
        </tr>
        <tr>
          <td>Regular</td>
          <td>‚â• 40%</td>
          <td><span class="color-box" style="background:#D97706"></span>√Çmbar 600</td>
          <td><code>D97706</code></td>
        </tr>
        <tr>
          <td>Cr√≠tico</td>
          <td>&lt; 40%</td>
          <td><span class="color-box" style="background:#DC2626"></span>Vermelho 600</td>
          <td><code>DC2626</code></td>
        </tr>
      </tbody>
    </table>

    <h2>üîß O que precisa ser feito</h2>

    <h3>1. Corrigir Exporta√ß√£o Excel com Cores</h3>
    <p><strong>Objetivo:</strong> Gerar Excel <code>.xlsx</code> com:</p>
    <ul>
      <li>C√©lulas coloridas RGB baseado no status</li>
      <li>Headers com estilo (negrito, cor de fundo)</li>
      <li>Formata√ß√£o condicional para taxa de entrega</li>
    </ul>
    
    <p><strong>Op√ß√µes:</strong></p>
    <ul>
      <li>Usar <code>xlsx-js-style</code> corretamente (verificar sintaxe)</li>
      <li>Usar <strong>ExcelJS</strong> (mais completo mas maior)</li>
      <li>Gerar via template <code>.xltx</code></li>
      <li>Criar API backend para gerar Excel (requer Supabase)</li>
    </ul>

    <h3>2. Adicionar Gr√°ficos ao Excel (Opcional)</h3>
    <p>A biblioteca <code>xlsx</code> padr√£o n√£o suporta cria√ß√£o de gr√°ficos. Alternativas:</p>
    <ul>
      <li>Usar ExcelJS com charts</li>
      <li>Gerar template com gr√°ficos pr√©-vinculados</li>
      <li>Criar Excel via backend (Python openpyxl, C# EPPlus)</li>
    </ul>

    <h3>3. Compatibilidade Power BI</h3>
    <p>A aba "PowerBI" j√° exporta dados flat. Para melhorar:</p>
    <ul>
      <li>Adicionar metadados de tipo de dados</li>
      <li>Formatar datas como ISO</li>
      <li>Criar relacionamentos sugeridos</li>
    </ul>

    <h2>üöÄ Como Executar Localmente</h2>
    <pre><code># Instalar depend√™ncias
npm install

# Rodar em desenvolvimento
npm run dev

# Build de produ√ß√£o
npm run build

# Preview do build
npm run preview</code></pre>

    <h2>üß™ Como Testar a Exporta√ß√£o</h2>
    <ol>
      <li>Acesse a aplica√ß√£o</li>
      <li>Importe um Excel de controle de entregas</li>
      <li>Clique em "Exportar Excel"</li>
      <li>Abra o arquivo <code>.xlsx</code> gerado</li>
      <li>Verifique as abas e formata√ß√£o</li>
    </ol>

    <h2>üìã Arquivos Importantes para Edi√ß√£o</h2>
    <table>
      <thead><tr><th>Arquivo</th><th>Fun√ß√£o</th></tr></thead>
      <tbody>
        <tr><td><code>src/lib/excelExport.ts</code></td><td><span class="badge badge-error">PRINCIPAL</span> L√≥gica de exporta√ß√£o Excel</td></tr>
        <tr><td><code>src/lib/excelParser.ts</code></td><td>Parser de Excel para Dataset</td></tr>
        <tr><td><code>src/lib/database.ts</code></td><td>Interfaces e storage</td></tr>
        <tr><td><code>src/components/dashboard/DashboardView.tsx</code></td><td>Bot√µes de exporta√ß√£o</td></tr>
        <tr><td><code>vite.config.ts</code></td><td>Config do PWA (limite de cache)</td></tr>
      </tbody>
    </table>

    <h2>üêõ Erros Conhecidos</h2>
    
    <div class="alert alert-warning">
      <strong>1. Bundle muito grande</strong><br>
      <code>Assets exceeding the limit: 2.79 MB</code><br>
      <strong>Causa:</strong> <code>xlsx-js-style</code> √© pesado<br>
      <strong>Solu√ß√£o:</strong> Usar dynamic import ou remover lib
    </div>

    <div class="alert alert-info">
      <strong>2. Stack overflow no build</strong><br>
      <code>runtime: goroutine stack exceeds 1000000000-byte limit</code><br>
      <strong>Causa:</strong> Erro do TypeScript checker (tempor√°rio)<br>
      <strong>Solu√ß√£o:</strong> Geralmente resolve ao rebuildar
    </div>

    <h2>üîó Links √öteis</h2>
    <ul>
      <li><a href="https://docs.lovable.dev" target="_blank">Lovable Docs</a></li>
      <li><a href="https://github.com/gitbrent/xlsx-js-style" target="_blank">xlsx-js-style</a></li>
      <li><a href="https://github.com/exceljs/exceljs" target="_blank">ExcelJS (alternativa)</a></li>
      <li><a href="https://recharts.org" target="_blank">Recharts</a></li>
    </ul>

    <h2>üìû Suporte</h2>
    <p>Para funcionalidades avan√ßadas de Excel (gr√°ficos embutidos, VBA, templates complexos), pode ser necess√°rio:</p>
    <ul>
      <li>Desenvolvedor especializado em OpenXML/Excel</li>
      <li>Backend em Python (openpyxl) ou C# (EPPlus) para gera√ß√£o server-side</li>
    </ul>

    <hr style="margin: 2rem 0; border: none; border-top: 2px solid #e2e8f0;">
    <p style="text-align: center; color: #94a3b8; font-size: 0.9rem;">
      Documenta√ß√£o gerada automaticamente | Dashboard RDA - Controle de Entregas<br>
      Projeto hospedado no <a href="https://lovable.dev" target="_blank">Lovable.dev</a>
    </p>
  </div>
</body>
</html>